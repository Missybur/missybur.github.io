(function(i,j){i.execute(function(){i.when("jQuery","dv-utils-stringify").register("logging",function(s,d){var h=function(a){var b=j.console;return b&&b[a]&&typeof b[a]==="function"?b[a]:function(){}},e={fatal:{consoleMethod:"error",logLevel:0,errorLevel:"FATAL"},error:{consoleMethod:"error",logLevel:1,errorLevel:"ERROR"},warn:{consoleMethod:"warn",logLevel:2,errorLevel:"WARNING"},info:{consoleMethod:"info",logLevel:3,errorLevel:null},debug:{consoleMethod:"debug",logLevel:4,errorLevel:null},log:{consoleMethod:"log",
logLevel:4,errorLevel:null},trace:{consoleMethod:"trace",logLevel:5,errorLevel:null}},g={},c;for(c in e)e.hasOwnProperty(c)&&(g[e[c].consoleMethod]=h(e[c].consoleMethod));var f=function(a){var a=a||null,b,c,d="";try{b=f.caller&&f.caller.caller&&f.caller.caller.caller||{},c=b.name||b._name||null}catch(g){}a&&(d+=a.charAt(0).toUpperCase()+a.slice(1));c&&(d+=":"+c);return d},b=function(){var a=!1,b=/\baivDebug=1\b/;if(document.cookie.match(b)||document.location.search.match(b))a=!0;return a}(),a=function(){var a=
!1,b=/\baivEmulateConsole=1\b/;if(document.cookie.match(b)||document.location.search.match(b))a=!0;return a}(),l;l=a?s("<ul />").addClass("dv-emulated-console").appendTo("body"):void 0;var n={},m=function(a,b){this._scriptName=a||null;this._log=b&&b.log||i.log||j.ueLogError};for(c in e)e.hasOwnProperty(c)&&function(c){m.prototype[c]=function(){var h=e[c].consoleMethod,i=arguments,m=e[c].logLevel,k=e[c].errorLevel,u=typeof this._scriptName==="string"?this._scriptName.toLowerCase():null,i=Array.prototype.slice.call(i),
v="";if((m=g&&g[h]&&typeof g[h]==="function"&&(b||u&&n[u])&&m<=6&&i)||k)(v=f(this._scriptName))&&i.unshift("["+v+"]");if(m&&(g[h].apply(j.console,i),a)){m=[];for(u=0;u<i.length;u++)typeof i[u]==="object"?m.push(d(i[u])):m.push(i[u]);s("<li />").text(m.join(" ")).addClass("dv-console-"+h).appendTo(l);l.scrollTop(l.get(0).scrollHeight)}k&&this._log&&this._log(d(i),k,v)}}(c);var k={create:function(a,c){if(k._mockConsole&&typeof k._mockConsole==="object")g=k._mockConsole;if(k._mockDebugFlag&&typeof k._mockDebugFlag===
"boolean")b=k._mockDebugFlag;return new m(a,c)},extend:function(a,c,d){if(k._mockConsole&&typeof k._mockConsole==="object")g=k._mockConsole;if(k._mockDebugFlag&&typeof k._mockDebugFlag==="boolean")b=k._mockDebugFlag;var f=a.prototype||a,c=new m(c,d);s.extend(f,c);for(var e in f)if(f.hasOwnProperty(e)&&typeof f[e]==="function")f[e]._name=f[e].name||e;return a}};for(c in e)e.hasOwnProperty(c)&&(k[c]=function(){var a=c,b=arguments,d=k.create();d[a].apply(d,b)});return k});i.register("dv-utils-stringify",
function(){return function(i){var d=[];return typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify(i,function(h,e){if(typeof e==="object"&&e!==null)if(d.indexOf(e)!==-1)return;else d.push(e);return e}):function e(g){var c;switch(g.constructor){case Object:c=[];for(var f in g)if(g.hasOwnProperty(f)&&d.indexOf(g[f])===-1){d.push(g[f]);var b=e(g[f]);b&&c.push('"'+f+'":'+b)}c="{"+c.join(",")+"}";break;case Array:c=[];for(f=0;f<g.length;++f)c.push(e(g[f]));c="["+c.join(",")+"]";break;
case String:c='"'+g.toString()+'"';break;case Function:break;default:c=g.toString()}return c}(i)}})})})(function(){var i=window.AmazonUIPageJS||window.P,j=i._namespace||i.attributeErrors;return j?j("DigitalVideoLoggingAssets"):i}(),window);
(function(i,j,s){i.execute(function(){i.when("jQuery","logging","dv-alert-templates-ready").register("aiv-alerts",function(d,h){function e(e,h,i,k){typeof h==="undefined"&&(h=b);typeof k==="undefined"&&(k=a);h=[f,h,k].join("-");k=d("#"+h).html();c.debug("getAlert",h,k);i==="light"&&k&&(k=k.replace(/dv-alerts-dark/g,"dv-alerts-light"));return g(d(k),e)}function g(a,b){if(a.length===0)c.error("_addContent missing $template",arguments);else if(b)return a.find(".a-alert-content").html(b).end()[0].outerHTML;
else c.error("_addContent missing content",arguments)}var c=h.create("aiv-alerts"),f="dv-alert-template",b="inline",a="info";return{getAlert:e,info:function(a,b,c){return e.call(e,a,b,c,"info")},warning:function(a,b,c){return e.call(e,a,b,c,"warning")},error:function(a,b,c){return e.call(e,a,b,c,"error")},success:function(a,b,c){return e.call(e,a,b,c,"success")}}});i.when("A","jQuery","logging","dv-ajax-cache","dv-ajax-chunk","dv-ajax-widgets","dv-ux","aiv-client-side-metrics").register("dv-ajax-handler",
function(d,h,e,g,c,f,b,a){var i=e.create("dv-ajax-handler"),n;n=function(b){this.options=b;this.nodes=[];i.debug("new AjaxHandler with",b);b=b.loggingName?b.loggingName:"dvweb-widget-reload-"+b.widgets.join("+");this.widgetMetrics=a.create({scope:b});i.debug("new AjaxHandler with",b,this.widgetMetrics)};n.prototype.cache=g;n.prototype.callAjax=function(){var a=this,b=a.options.widgets.length,e=h.Deferred();if(a.options.asin){if(a.options.preCache)a.cache.prepareCacheForAsin(a.options.asin);else if(a.cache.isAsinPrepared(a.options.asin)){a.cache.flushCacheToPage(a.options.asin);
a.handleAjaxSuccess();return}else a.prepareWidgetsForRefresh();a.widgetMetrics.ajaxStart();d.ajax(a.options.url,{params:{asin:a.options.asin,widgets:a.options.widgets},chunk:function(g){g=c(g,a.options.widgets,a.options.DOMRootID);g.isValid?(d.trigger("dv:ajax:chunk:success:"+a.options.DOMRootID),a.options.preCache?a.cache.addChunkToCache(a.options.asin,g):(g=f(g),g=g.reloadWidget(),--b<1&&g.done(function(){a.chunksReplaced(e)}))):--b<1&&a.chunksReplaced(e)},success:function(b,c,d){a.options.preCache&&
a.cache.declareReady(a.options.asin);a.handleAjaxSuccess();a.widgetMetrics.ajaxSuccess({xhr:d})},error:function(){a.removeUILock();if(a.options.reloadOnFailure)j.location.href="/gp/product/"+a.options.asin},timeout:1E4});return e.promise()}};n.prototype.chunksReplaced=function(a){a.resolve();this.widgetMetrics.ajaxDone()};n.prototype.handleAjaxSuccess=function(){this.removeUILock()};n.prototype.removeUILock=function(){for(var a=0,c=this.nodes.length,d;a<c;a++)d=this.nodes[a],b.enable(d)};n.prototype.updateUrl=
function(){typeof j.history.replaceState==="function"?j.history.replaceState(this.options,this.options.title,"/gp/product/"+this.options.asin):j.location.hash="#!"+this.options.asin};n.prototype.prepareWidgetsForRefresh=function(){var a,c=this.options.DOMRootID,d;for(a=0;a<this.options.widgets.length;a+=1)d=this.options.widgets[a],d=c?h("#"+c+" ."+d):h("#"+d),b.disable(d),this.nodes.push(d)};return function(a){return new n(a)}});i.when("A","dv-ajax-widgets").register("dv-ajax-cache",function(d,h){var e;
e=function(){this.asinCache={}};e.prototype.isAsinPrepared=function(d){return typeof this.asinCache[d]==="object"};e.prototype.prepareCacheForAsin=function(d,c){if(!this.isAsinPrepared(d))this.asinCache[d]={},this.asinCache[d].widgets=c,this.asinCache[d].chunks=[],this.asinCache[d].isLoaded=!1,this.asinCache[d].flushOnReady=!1};e.prototype.addChunkToCache=function(d,c){this.isAsinPrepared(d)&&this.asinCache[d].chunks.push(c)};e.prototype.declareReady=function(d){if(this.isAsinPrepared(d))this.asinCache[d].isLoaded=
!0;this.asinCache[d].flushOnReady&&this.flushCacheToPage(d)};e.prototype.flushCacheToPage=function(d){var c,f;if(this.asinCache[d].isLoaded){for(c=0;c<this.asinCache[d].chunks.length;c+=1)f=h(this.asinCache[d].chunks[c]),f.reloadWidget();delete this.asinCache[d]}else this.asinCache[d].flushOnReady=!0};e.prototype.clearExpiredCacheForAsin=function(d){this.isAsinPrepared(d)&&this.asinCache[d].isLoaded&&delete this.asinCache[d]};return new e});i.when("jQuery","A").register("dv-ajax-chunk",function(d){var h;
h=function(e,g,c){this.isValid=!1;this.expectedWidgets=g;if(d.isArray(e)&&e.length===3)this.id=e[1],this.data=e[2],this.DOMRootID=c,this.validateChunk()};h.prototype.validateChunk=function(){if(d.inArray(this.getChunkRawID(),this.expectedWidgets)!==-1&&this.getChunkData())this.isValid=!0};h.prototype.getChunkData=function(){return d.trim(this.data)};h.prototype.getChunkRawID=function(){return this.id};h.prototype.getDOMSelector=function(){var e=this.getChunkRawID();return this.DOMRootID?d("#"+this.DOMRootID+
" ."+e):d("#"+e)};return function(d,g,c){return new h(d,g,c)}});i.when("A","logging","dv-ux").register("dv-ajax-widgets",function(d,h,e){var g=h.create("dv-ajax-widgets"),c,f;c=function(b){this.nodeID=b.getChunkRawID();this.widgetHTML=b.getChunkData();this.$node=b.getDOMSelector()};c.prototype.reloadWidget=function(){var b=this;if(b.$node.length)return f=e.replaceContent(b.$node,b.widgetHTML),f.done(function(){g.debug("dv:ajax:chunk:replaced:"+b.nodeID);d.trigger("dv:ajax:chunk:replaced:"+b.nodeID)}),
f};return function(b){return new c(b)}});i.when("A","dv-ajax-handler","ready").register("dv-ajax-reload",function(d,h){var e=d.$,g={widgets:"dv-dp-title-content,dv-dp-left-content,dv-action-box,dv-main-bottom-section,dv-episode-list,dv-center-aiv,dv-customer-reviews".split(","),reloadOnFailure:!1,title:document.title,preCache:!1,url:"/gp/video/apps/ajax-detail-page"};return{getWidgets:function(c){c=e.extend({},g,c);return h(c).callAjax()}}});i.when("A","jQuery","logging","aiv-util-event","a-modal",
"dv-modal-stack","dv-modal-templates-ready").register("aiv-modal",function(d,h,e,g,c,f){var b,a,l,n;function m(a){var b=k(a),a=h("<div/>").attr({id:b.id}),e=c,i={},l={},i={},n=[],m=[],y,i={name:b.id,url:j(b),content:t(b),header:o(b),hideHeader:G?!1:b.hideHeader,footer:A(b),cache:b.cache||!1,width:"90%",padding:b.theme==="dark"?"none":b.padding,"max-width":b.maxWidth||b.width||400,closeButton:b.theme==="dark"?!1:v(b)};L&&d.capabilities.mobile&&b.hasScrollableContent&&(e=L);y=e.create(a,i);r.debug("created modal with args:",
i,y);g.bestowEvents(l);z(b.id,l);B(b,l,n,m);y._display=y.show;i={on:u(l),getName:function(){return b.id},_show:function(){y._display()},show:function(){f.add(y);return y},remove:function(){r.debug("remove: "+b.id,y,b);H(n,m);e.remove(b.id)}};h.extend(y,i);if(b.theme==="dark"||b.padding==="none")y.on("afterShow",function(){var a=y.$popover,c=a.find(".a-popover-inner, .a-secondary-view-inner");a.find(".a-popover-wrapper").addClass("dv-aui-dark-wrapper");c.addClass("dv-modal-wrapper-dark");r.debug("afterShow",
b);c.css({padding:0})}),y.on("ajaxContentLoaded",function(){y.$popover.append(p(b.theme))});y.on("afterHide",function(){e.remove(b.id)});y.on("closeModal",function(){e.remove(b.id)});y.on("optOut",function(a){a.url&&d.get(a.url+a.checked)});return y}function k(c){var d=h(c.selector||"#"+c.id).data("dv-modal"),f={};if(!J)x.submitTemplate=h(b).html(),x.cancelTemplate=h(a).html(),x.linkTemplate=h(l).html(),x.checkboxTemplate=h(n).html(),r.debug("_init:",x),J=!0;h.extend(!0,f,d,c);f.originalId=f.id||
f.name;f.id=(f.id||f.name)+"_"+y++;r.debug("getOptions:",{args:c,dataAttributes:d,options:f});return f}function j(a){var b="",c=a.url;if(c)return a.urlParameters&&(b=c.match(/\?/)?"&":"?",b+=h.param(a.urlParameters)),c+b}function t(a){var b,c;if(!(c=a.content))if(c=["#a-popover-",a.name].join(""),b=h(c),r.info("element: "+c,b),!(c=b.length?b.html():"")){c="";b=a.url;var d=h(a.selector||"#"+a.originalId);r.info({url:b,element:d});b||(c=d.html(),r.debug("_createModal: no url or content, element html",
c))}r.info("_getContent",c);b=c;c=a.theme;if(!b)return"";c&&(b=h("<div />").addClass("dv-modal-wrapper-"+c).append(b),v(a)&&b.append(p(c)),b=b[0]);return b}function p(a){return h('<button type="button" role="button" data-action="a-popover-close" class="a-declarative"><span>X</span></button>').addClass("dv-modal-close-button-"+a)}function o(a){var b=a&&a.header||{},a=a&&a.hideHeader;r.info("hideHeader:",a,b);return a?"":b.text||""}function A(a){var b="",c=a.buttons,d={},f=a.id;r.debug("_getFooter args:",
a);c&&h.each(c,function(a,c){var d=w({id:f,elemOptions:c,template:x[c.type+"Template"]});r.debug("_getFooter buttonObj:",d);b+=d.html});a.optOut&&a.optOut.url&&(d=w({id:f,elemOptions:{type:"checkbox",text:a.optOut.text},template:x.checkboxTemplate}),b+=d.html);return b}function u(a){return function(b,c,d){r.debug("on:",a,b,c,d);a.on([b],c,d)}}function v(a){var b=!1;if(typeof a.closeButton!=="undefined")b=a.closeButton;else if(typeof a.showCloseButton!=="undefined")b=a.showCloseButton;return b}function z(a,
b){h.each(C,function(c,f){d.on("a:popover:"+f+":"+a,function(a){b.fire(f,a)})})}function B(a,b,c,d){r.debug("_addEventListeners",a,b,c,d);a.optOut&&a.optOut.url&&(M("#"+a.id+"-checkbox","optOut",{url:a.optOut.url},b),d.push({id:a.id}));a.buttons&&h.each(a.buttons,function(d,f){var e=f.id||a.id+"-"+f.type,e={name:e,id:"#"+e,eventArgs:f.eventArgs,customEvent:f.customEvent||"dv:dv-modal:"+f.type,customActionEndpoint:f.customActionEndpoint};F(e,b,a.isDeclarative);c.push(e)})}function w(a){var b=a.elemOptions||
{},c=a.template||"",d={};r.debug("_getFooterUIElement args:",a);d.html="";d.name=b.id||a.id+"-"+b.type;d.id="#"+d.name;d.text=b.text;d.url=b.url;if(d.text&&c)d.html=D(c,d.name,d.text,d.url);r.debug("_getFooterUIElement element:",d);return d}function D(){var a=Array.prototype.shift.call(arguments),b=arguments,a=a.replace(/(\r\n|\n|\r)|(^\s+|\s+$)/gm,"");r.debug("_formatTemplate:",a,b);return a?a.replace(/\{(\d+)\}/g,function(a,c){return typeof b[c]!=="undefined"?b[c]:a}):(r.error("Template missing",
b),s)}function M(a,b,c,d){r.debug("_addCheckBoxEventListener:",a,b,c);h("body").delegate(a+" input[type='checkbox']","change",function(){c.checked=!!this.checked;r.debug(a+" checkbox changed",c);d.fire(b,c)})}function F(a,b,c){r.debug("_addButtonEventListener button:",b,a);h("body").delegate(a.id,"click",function(){c?d.trigger(a.customEvent,a.eventArgs):b.fire(a.customEvent,a.eventArgs)})}function H(a,b){r.debug("_removeEventListeners",a,b);h.each(a,function(a,b){h("body").undelegate(b.id,"click")});
h.each(b,function(a,b){h("body").undelegate(b.id+" input[type='checkbox']","change")})}var r=e.create("aiv-modal"),C=["afterHide","afterShow","close","ajaxContentLoaded"];b="#SubmitTemplate";a="#CancelTemplate";l="#LinkTemplate";n="#CheckBoxTemplate";var x={},J=!1,y=0,G=!1,L;i.when("a-secondary-view").execute(function(a){L=a;G=!0});d.declarative("aiv-modal","click",function(a){var a=a.data,b;a.isDeclarative=!0;r.debug("declarative data:",a);b=m(a);b.show();d.on("aiv:modal:close:declarative",function(){b.remove();
d.off("aiv:modal:close:declarative")})});h("body").delegate('[data-action="aiv-modal"] a',"click",function(a){a.preventDefault()});return{create:m}});i.when("A","jQuery","logging").register("dv-modal-stack",function(d,h,e){function g(a){if(typeof a==="undefined")return m;b.debug("[_isActive] set",a);m=a}function c(a){b.debug("[_displayModal]",a);g(!0);a._show()}function f(f){d.delay(function(){var d,f;f=i.pop();b.debug("[_finishedHiding]",i.length,f);f&&(f=f.attrs("name"),n[f]=!1);g(!1);if(f=i.length)d=
i[f-1],c(d,a);b.debug("[_finishedHiding] nextModalInQueue",d)},typeof f.delay!=="undefined"?f.delay:a)}var b=e.create("dv-modal-stack"),a=600,i=[],n={},m=!1;return{add:function(a){var d=a.attrs("name");b.debug("[add]",d,g());a.on("afterHide",f);n[d]=!0;i.unshift(a);g()||c(a,0)},_internal:{_isActive:g,_types:n,_stack:i,_displayModal:c,_afterHide:f}}});i.when("dv-get-reftag-from-url","dv-send-analytics","dv-url-param","dv-get-elem-by-alias").register("dv-utilities",function(d,h,e,g){return{getRefTagFromURL:d,
sendAnalytics:h,urlParam:e,getElemByAlias:g}});i.register("dv-get-reftag-from-url",function(){return function(d){if(d&&(d=d.match(/\bref_?=([^?&]*)\b/i))&&d.length>=2)return d[1]}});i.when("jQuery").register("dv-send-analytics",function(d){return function(h){h&&d.ajax({url:"/gp/video/widgets/main-section/ajax/analytics.html/ref="+h,data:{},dataType:"json",timeout:1E4})}});i.register("dv-url-param",function(){var d;return function(h){if(!d){d={};for(var e=(document.location.search||"").substring(1).split("&"),
g=0;g<e.length;g++){var c=e[g].split("=");d[c[0]]=c[1]}}return!h?d:d[h]}});i.when("A","jQuery").register("dv-get-elem-by-alias",function(d,h){return function(d,g){return!d&&!g?void 0:h(d).filter(function(c,d){var b=h(d).data("aliases");return!!(b&&h.inArray(g,b.split(","))!==-1)})}});i.when("A","jQuery","logging").register("dv-content",function(d,h,e){function g(b,a){c.info(b,a);var d=h.extend(!0,{},f,a),e="."+d.className,d=h("<"+d.wrapperTag+" />").addClass(d.className),g=b.children(e);g.length||
(b.wrapInner(d),g=b.children(e).css({overflow:"hidden"}));return g}var c=e.create("dv-content"),f={wrapperTag:"div"};return{replaceContent:function(b,a,f){function e(){p.removeAttr("style");k.resolve();typeof o.callback==="function"&&o.callback()}function i(){d.animate(p,{opacity:1,top:0},o.timeToFadeIn,o.easing,e)}c.info(b,a,f);var k=h.Deferred(),j=h(a),t=b.height(),p=g(b,{className:"js-dv-replace-content-wrapper"}),o={};h.extend(!0,o,{timeToFadeIn:300,timeToFadeOut:200,timeToResize:200,easing:"ease-in-out",
fadeInMovePercent:0.15,callback:null},f);!b instanceof h&&c.error("replaceContent $element is not a jQuery object",b);d.animate(p,{opacity:0},o.timeToFadeOut,o.easing,function(){var a={height:p.empty().append(j).height(),top:0*o.fadeInMovePercent};p.height(t).css({position:"relative"});d.animate(p,a,o.timeToResize,o.easing,i)});return k.promise()},wrapContent:g,hideContent:function(b){b.length&&(b=g(b,{className:"js-dv-hide-content-wrapper"}),d.animate(b,{opacity:0}))},showContent:function(b){if(b.length){var a=
b.find(".js-dv-hide-content-wrapper");a.length&&d.animate(a,{opacity:1},function(){a.removeAttr("style")})}}}});i.when("A","jQuery","logging").register("dv-extendable-element",function(d,h,e){var g=e.create("dv-extendable-element"),c=function(c){g.info(c);this.$element=c};c.prototype.element=function(){g.info(this.$element);return this.$element};c.prototype.addBehaviours=function(){var c=this,b=Array.prototype.slice.call(arguments);g.debug(b);h.each(b,function(a,b){for(var d in b)b.hasOwnProperty(d)&&
(c[d]=c.extensify(b[d],d))})};c.prototype.extensify=function(c){var b=this;g.info(c);return function(){var a=Array.prototype.slice.call(arguments);a.unshift(b.$element);b._value=c.apply(this,a);return b}};c.prototype.value=function(){g.info(this);return this._value};return function(d){g.info(d);var b=Array.prototype.slice.call(arguments,1),a=new c(d);b&&a.addBehaviours.apply(a,b);return a}});i.when("A","jQuery","logging","dv-content").register("dv-interactive",function(d,h,e,g){var c=e.create("dv-interactive"),
f={disableOpacity:0.2},b=h("<div />").addClass("dv-disable-overlay js-dv-disable-overlay");return{disable:function(a,d){c.debug(a);var e=h.extend(!0,{},f,d),i,k;a&&a.length&&!a.find(".js-dv-disable-overlay").length&&(k=b.clone(),k.click(function(a){a.preventDefault()}),i=g.wrapContent(a,{className:"js-dv-disable-wrapper"}),i.animate({opacity:e.disableOpacity},function(){i.css({visibility:"hidden"})}),a.addClass("dv-disable-wrapper").append(k))},enable:function(a){var b;c.debug(a);a&&a.length&&(a.find(".js-dv-disable-overlay").remove(),
b=a.find(".js-dv-disable-wrapper"),b.css({visibility:"visible",opacity:0}),b.animate({opacity:1},function(){b.removeAttr("style")}))}}});i.when("A","jQuery","logging").register("dv-spinner",function(d,h,e){var g;function c(a){return!!a.find("."+g).length}function f(){return'<div class="dv-spinner"></div>'}var b=e.create("dv-spinner"),a={theme:"light",size:"medium"};g="dv-spinner-wrapper";return{addSpinner:function(d,e){b.debug(d,e);if(!c(d)){var i=h.extend(!0,{},a,e);b.debug(i.theme,i.size);var i=
h(f()),k=g;b.debug(i,k);i=h("<div />").addClass(k).append(i).clone();d.addClass("dv-spinner-container").append(i)}},removeSpinner:function(a){a.length&&(a.find("."+g).remove(),a.removeClass("dv-spinner-container"))},hasSpinner:c,getSpinner:f,getSpinnerWrapper:function(a){return a.find("."+g)}}});i.when("A","jQuery","logging","dv-content").register("dv-text",function(d,h,e,g){var c=e.create("dv-replace-text"),f="js-dv-replace-text-wrapper",b="js-dv-replace-text-new",a="js-dv-replace-text-progress";
return{replaceText:function(e,i,j){function k(){c.info("cleanUp",e);B.remove();t.removeAttr("style").removeClass(b).addClass(f);e.height("auto").removeClass(a);w.callback()}c.info(e,i,j);var q=h.Deferred(),t=h(i),p=e.outerWidth(),o=e.outerHeight(),A=e.css("padding-top"),u=e.css("padding-bottom"),v=e.css("padding-left"),z=e.css("padding-right"),B=g.wrapContent(e,{className:f,wrapperTag:"span"}),w={},D={},s={},F={},H={};h.extend(!0,w,{reverse:!1,easing:"ease-out",timeToChange:150,callback:function(){q.resolve()}},
j);!e instanceof h&&c.error("replaceContent $element is not a jQuery object",e);t.length||c.error("replaceContent $content is not an element",i);e.hasClass(a)?B.html(i):(D={position:"absolute",width:p,height:o,left:0,opacity:1,top:0},s={top:w.reverse?o:-o},F={position:"absolute",width:p,height:o,paddingBottom:u,paddingTop:A,paddingLeft:v,paddingRight:z,top:w.reverse?-o:o,left:0,opacity:0},H={top:0,opacity:1},e.css({position:"relative",height:o}).addClass(a),B.css(D),t.addClass(b).css(F),e.append(t),
d.animate(B,{opacity:0},w.timeToChange/2,w.easing),d.animate(B,s,w.timeToChange,w.easing),d.animate(t,H,w.timeToChange,w.easing,k));return q.promise()}}});i.when("jQuery","logging","dv-extendable-element","dv-content","dv-text","dv-interactive","dv-spinner").register("dv-ux",function(d,h,e,g,c,f,b){h.create("dv-ux");return{disable:f.disable,enable:f.enable,addSpinner:b.addSpinner,removeSpinner:b.removeSpinner,getSpinner:b.getSpinner,replaceText:c.replaceText,replaceContent:g.replaceContent,wrapContent:g.wrapContent,
hideContent:g.hideContent,showContent:g.showContent}});i.when("jQuery","logging","dv-extendable-element","dv-content","dv-text","dv-interactive","dv-spinner").register("dv-ux-mixins",function(d,h,e,g,c,f,b){h.create("dv-ux");return{extendable:e,content:g,text:c,interactive:f,spinner:b}});i.when("A","jQuery","logging","dv-ux").register("dv-buttons",function(d,h,e,g){function c(a,b,c){b=h("<span />").append(b);g.replaceText(a.find("."+k.buttonText),b,{reverse:c})}function f(a,b,d,e){b&&(a.removeClass([k.confirm,
k.processing,k.primary].join(" ")),(b=k[b]||"")&&a.addClass(b));d&&c(a,d,e)}function b(){j.log("[resetConfirmButtons]");var c=h("."+k.confirm);c.length&&c.each(a);m&&h(document).unbind("click",b)}function a(a,b){var c=h(b),d=c.data("orinalText");f(c,"primary",d,!0)}function i(a){if(!a.data("orinalText")){var b=a.text();a.data("orinalText",b)}}var j=e.create("dv-button"),m=d.capabilities.touch,k={confirm:"dv-confirm",processing:"js-dv-processing dv-button-processing",primary:"dv-oneclick",buttonText:"dv-button-text"};
return{buttonContent:c,buttonState:f,addProcessingState:function(a,b){j.log("[addButtonProcessingState]");a.each(function(a,c){i(h(c));f(h(c),"processing",b)})},resetButtonsOriginalState:function(b){b.length&&b.each(a)},addConfirmState:function(a,c){j.log("[addButtonConfirmState]");a.each(function(a,b){i(h(b));f(h(b),"confirm",c)});m&&h(document).bind("click",b)},resetConfirmButtons:b}});i.when("A").register("dv-analytics",function(d){var h=d.$;return{log:function(d,g,c){var f="",b="",a="",i="",c=
c!==null?c:{};if(typeof c.pageType!=="undefined")f=c.pageType;if(typeof c.subPageType!=="undefined")b=c.subPageType;if(typeof c.store!=="undefined")a=c.store;if(typeof c.requestId!=="undefined")i=c.requestId;h.ajax({url:"/gp/video/analytics/clickstream-logger.html",data:{asin:d!==null?d:"",pageType:f,subPageType:b,pageAction:g!==null?g:"",tabId:a,pageRequestId:i},dataType:"json",type:"POST",timeout:1E4})},recordWeblab:function(d,g,c){h.ajax({url:"/gp/video/analytics/weblab-logger.html",data:{weblab:d,
treatment:g,rid:c.requestId},dataType:"json",type:"POST",timeout:1E4})},constants:{PLAY_TRAILER:"PlayTrailer",PLAY_STREAM:"PlayStream"}}});i.when("A","jQuery","logging","aiv-modal").register("dv-async",function(d,h,e,g){return{create:function(c,f){function b(a){var b="";if(a&&typeof a==="function")b=a.name,b||(b=(a=/^function\s+([\w\$]+)\s*\(/.exec(a.toString()))?a[1]:"");return b}function a(a,b){g.create({id:b}).show();o.error(a)}function l(){return{customError:function(){},timeout:function(b,c,
d){a(d,"dv-modal-ajax_timeout")},error:function(b,c,d){a(d,"dv-modal-ajax_error")},abort:function(){o.warn("abort")},parsererror:function(b,c,d){a(d,"dv-modal-ajax_error")}}}function n(a){var c=e.create([p,b(a)].join(":"),f||i);return function(){try{a.apply(this,arguments)}catch(b){c.error(b)}}}function m(a){var b=[200,302],c=h.extend({},l(),a);return{success:function(){o.error("done method must be overridden")},error:function(a,d,f){h.inArray(parseInt(a.status,10),b)<0&&o.warn(a.status);if(d&&typeof c[d]===
"function")c[d](a,d,f);else c.error(a,d,f);c.customError(a,d,f)}}}function k(a,b,c){var d={accepts:s,contentType:s,cache:!1,indicator:"",method:"post",params:{},timeout:1E4,withCredentials:!0},f=0,e=c&&c.maxRetrys||0,c=m(c),g={},i,l;h.extend(g,d,c,b);o.debug(g);g.success=n(g.success);i=n(g.error);g.error=i;l=function(){o.log(f);g.error=e>++f?l:i;q(a,g)};if(e>f)g.error=l;q(a,g)}function q(a,b){a.match("^(/|"+(j.location.protocol+"//"+j.location.host)+")")?d.ajax(a,b):h.ajax(a,t(b))}function t(a){o.debug("convertOptions",
a);var b={data:a.params,success:a.success,error:a.error};h.support.cors?(b.dataType="json",b.type="POST",b.crossDomain=!0,b.xhrFields={withCredentials:!0}):(b.dataType="jsonp",b.type="GET",b.jsonpCallback=a.jsonpCallback);return b}var p=c||"dv-async",o=e.create(p,f||i);return{wrap:n,delay:function(a,b){d.delay(n(a),b)},ajax:k,get:function(a,b,c,d){c=c||{};c.method="get";c.success=b;return k(a,c,d)},post:function(a,b,c,d,f){d=d||{};d.method="post";d.params=b;d.success=c;return k(a,d,f)},deferred:function(){function a(b,
c){return function(a){b(n(a));return c}}var b=h.Deferred(),c=b.promise();h.each(["done","fail","always","then"],function(b,d){d==="then"?c.then=function(a,b){c.done(a).fail(b);return c}:c[d]=a(c[d],c)});b.promise=function(){return c};return b}}}}});i.when("logging").register("aiv-client-side-metrics",function(d){var h=d.create("aiv-client-side-metrics"),e=j.uet,g=j.ues,c=j.uex,f=j.ue,b=function(a){h.log("[CSM] new with options",a);this.scope=a&&a.scope};b.prototype.record=function(a,b){h.log("[CSM] uet "+
this.scope+" "+a,b);typeof e==="function"&&e(a,this.scope,b)};b.prototype.set=function(a,b){h.log("[CSM] ues "+this.scope+" "+a,b);typeof g==="function"&&g(a,this.scope,b)};b.prototype.publish=function(a,b){h.log("[CSM] uex "+this.scope+" "+a,b);typeof c==="function"&&c(a,this.scope,b)};b.prototype.counter=function(a,b,c){h.log("[CSM] ue.count "+a+" "+b);c=c||{scope:this.scope};f&&typeof f.count==="function"&&f.count(a,(f.count(a,s,c)||0)+(b||1),c)};b.prototype.timeOfClick=function(a){this.record("tc",
a)};b.prototype.experiment=function(a){this.record("x",a)};b.prototype.calculationEnd=function(a){this.record("pc",a)};b.prototype.clickToNavStart=function(a){this.record("ns",a)};b.prototype.clickToNavEnd=function(a){this.record("ne",a)};b.prototype.clickToBodyBegin=function(a){this.record("bb",a)};b.prototype.clickToATF=function(a){this.record("af",a)};b.prototype.clickToCF=function(a){this.record("cf",a)};b.prototype.clickToBodyEnd=function(a){this.record("be",a)};b.prototype.requestId=function(a){this.set("id",
a)};b.prototype.startTime=function(){this.set("t0",new Date)};b.prototype.baseOnClientTime=function(){this.set("ctb","1")};b.prototype.clickToPageLoaded=function(a){this.publish("ld",a)};b.prototype.ajaxStart=function(a){this.timeOfClick(a)};b.prototype.ajaxSuccess=function(a){var b=a.requestId,a=a.xhr;!b&&a&&typeof a.getResponseHeader==="function"&&(b=a.getResponseHeader("x-amz-id-1"));this.requestId(b);this.startTime();this.baseOnClientTime()};b.prototype.ajaxDone=function(a){this.clickToBodyEnd(a);
this.clickToPageLoaded(a)};return{create:function(a){return new b(a)}}});i.when("A","jQuery").register("dv-reftag",function(d,h){function e(c){h.ajax({url:g+c,data:{},dataType:"json",timeout:1E4})}var g="/gp/video/widgets/main-section/ajax/analytics.html/ref=";d.declarative("dv-record-reftag","click",function(c){c.data&&c.data.reftag&&e(c.data.reftag)});return{record:e}});i.when("jQuery").register("dv-eventBinder",function(d){return{bind:function(h){h=h||document;this._eventRegistry=this._eventRegistry||
[];var e=this,g=/^\s*(.+)\s+(\S+)\s*$/,c=function(a,b,c){var f=function(a,b){a.source=d(this);c.call(e,a,b)};if(a)if(d(h).on)d(h).on(b,a,f);else d(h).delegate&&d(h).delegate(a,b,f);else d(h).bind(b,f);e._eventRegistry.push({baseElement:h,selector:a,eventName:b})},f;for(f in this){var b=f.match(g);b&&this[f]&&typeof this[f]==="function"&&c(b[1]!=="subscribe"?b[1]:s,b[2],this[f])}},unbind:function(){for(var h=this._eventRegistry.length-1;0<=h;h--){var e=this._eventRegistry[h];e.selector?d(e.baseElement).off?
d(e.baseElement).off(e.eventName,e.selector):d(e.baseElement).undelegate&&d(e.baseElement).undelegate(e.selector,e.eventName):d(e.baseElement).unbind(e.eventName);this._eventRegistry.splice(h,1)}}}});i.when("A","jQuery","logging").register("dv-form",function(d,h,e){var g=e.create("dv-form");return{data:function(c,d){g.debug(c,d);var b=c.find("input").serializeArray(),a={};h.each(b,function(b,c){if(c.name)a[c.name]=c.value});return a}}});i.when("jQuery","logging","dv-async").register("promise-pipeline",
function(d,h,e){return{create:function(g,c,f){function b(a){m.errors=m.errors||[];i.error(a);m.errors.push(a)}function a(c){var f,e,g;if(c>=j.length)k.resolve(m);else if(f=j[c]||{},g=[f.name,"step:",c].join(" "),f.getPromise&&typeof f.getPromise==="function"){i.debug(g+" got promise",{step:c,currentStep:f,options:m});try{e=f.getPromise(m),e.done(function(b){d.extend(!0,m,b);i.debug(g+" done",m,b);a(++c)}),e.fail(function(a){d.extend(!0,m,a);i.debug(g+" fail",m,a);k.reject(m)})}catch(h){b(h),k.reject(m)}}else b(g+
" getPromise is not a function"),a(++c)}var c=c||"promise-pipeline",i=h.create(c,f),f=e.create(c,f),j=g.promises,m=g.options,k=f.deferred();a(0);return k.promise()},step:function(d,c,f){var b=e.create(d,f);return{name:d,getPromise:function(a){var d=b.deferred();c(d,a);return d.promise()}}}}});i.when("logging").register("dv-register-once",function(d){var h=d.create("dv-content");return function(d,g){i.now(d).execute(function(c){if(typeof c!=="undefined")h.info("Tried to re-register "+d,g);else try{i.declare(d,
g)}catch(f){h.info("Tried to re-register "+d,g)}})}});i.when("A","jQuery","logging").register("aiv-util-event",function(d,h,e){var g=e.create("aiv-util-event");return{bestowEvents:function(c){var d={};c.fire=function(b,a){var c,e,i,k;c=typeof b==="string"?b:b.type;g.log("[event] fire",c,b,a);if(d.hasOwnProperty(c)){c=d[c];for(k=0;k<c.length;k+=1)i=c[k],e=i.method,typeof e==="string"&&(e=this[e]),i=h.extend(!0,{},i.argsObj,a),e.call(this,i)}return this};c.on=function(b,a,c){g.log("[event] on",b,a,
c);a={method:a,argsObj:c};d.hasOwnProperty(b)?d[b].push(a):d[b]=[a];return this};return c}}})})})(function(){var i=window.AmazonUIPageJS||window.P,j=i._namespace||i.attributeErrors;return j?j("DigitalVideoWebUtilityAssets"):i}(),window);
(function(i,j,s){i.execute(function(){i.when("A","logging","dv-pp-pin-view","aiv-util-event","dv-async").register("dv-pp-pin-controller",function(d,h,e,g,c){var f,b,a,j,n,m,k,q,t,p,o,s,u,v,z=h.create("dv-pp-pin-controller"),B=c.create("dv-pp-pin-controller",i),w=d.$,D={strings:{CHECKING_PIN:"Checking Pin...",PIN_INVALID:"The Pin you have entered is invalid, please try again.",AUTHENTICATION_SUCCESS:"Authentication successful.",AUTHENTICATION_FAILURE:"This pin is not correct, please try again",TOKEN_FAILURE:"Your session has expired, please refresh the page and try again.",
BAD_REQUEST:"We had a problem validating your pin, please refresh the page and try again"},urls:{pinCheckUrl:"/gp/video/usdvm/ajax/show_parental_dialog.html",pinAuthUrl:"/gp/video/usdvm/ajax/pin-check.html"},action:"PURCHASE",validationPeriod:1E3,successMsgDuration:200,isTestRun:!1,numPins:5,view:{pinConfig:{numPins:5},events:{submit:"submitPin",show:"show",hide:"hide",cancel:"cancel",close:"close"}}};p="pinAuthFailure";o="sessionExpired";u="error";s="success";v="pinRequiredCheckComplete";n="UNAUTHORIZED";
m="AUTHORIZED";t="PENDING";k="ERROR";q="TOKEN_INVALID";f="INVALID_CSRF_TOKEN";a="WRONG_PIN";j="INCORRECT_PIN_FORMAT";b="BAD_REQUEST";return{create:function(c,h){function i(a,b){Q.fire(a,b)}function r(){var a=I.getUserPin();RegExp("^\\d{"+E.numPins+"}$").test(a)?(I.createMessage("info",E.strings.CHECKING_PIN),T(a)):(I.createMessage("error",E.strings.PIN_INVALID),I.resetPin())}function C(){var a=K.activeAsin;G(a)?L(a):(delete N[a],i(p,{asins:a}));delete K.activeAsin}function x(a,b,c){z.debug(a,b,c);
a&&(b||(b=n),N[a]=J(b,c))}function J(a,b){var c=(new Date).getTime(),d=c+E.validationPeriod;return{getStatus:function(){return a},getTimestamp:function(){return c},isExpired:function(){return d<(new Date).getTime()},getToken:function(){return b}}}function y(a){z.debug(a);if(a)return N[a]||S(a),N[a]}function G(a){z.log("[DV PIN] isAuthorized",a);if(!a)return!1;O(a);return y(a).getStatus()===m&&O(a)?!0:!1}function L(a){var b=y(a);z.log("[DV PIN] handleAsinAuthorization",a,b.getStatus());switch(b.getStatus()){case k:i(p,
{asins:a});x(a,n);break;case q:i(o,{asins:a});x(a,n);break;case m:O(a)?i(s,{asins:a,token:b.getToken()}):(x(a,n),L(a));break;case n:I.trigger(E.view.events.show);K.activeAsin=a;break;case t:K.callbackHandleAuth=!0;break;default:z.log("[DV PIN] handleAsinAuthorization default",a,b),i(p,{asins:a}),x(a,n)}}function O(a){a=y(a);return a.getStatus()!==m?!1:a.isExpired()?!1:!0}function P(a){a&&typeof a==="function"&&a()}function R(a){z.debug(a);B.ajax(a.url,{params:a.data,success:function(){a.success.apply(this,
arguments);P(a.complete)}},{maxRetrys:3,customError:function(){i(u);P(a.error);P(a.complete)}})}function T(a){z.debug(a);R({url:E.urls.pinAuthUrl,data:{csrfToken:E.csrfToken,pin:a,asin:K.activeAsin},type:"jsonp",success:U,error:function(){I.createMessage("error",E.strings.AUTHENTICATION_FAILURE)}})}function U(c){var d=K.activeAsin,e;z.log("[DV PIN] performPinAuthenticationSuccess",c);if(c.success)I.createMessage("success",E.strings.AUTHENTICATION_SUCCESS),x(d,m,c.token),I.trigger(E.view.events.hide,
{delay:E.successMsgDuration});else{switch(c.error){case f:e=E.strings.TOKEN_FAILURE;break;case b:e=E.strings.BAD_REQUEST;break;case a:case j:e=E.strings.AUTHENTICATION_FAILURE}I.createMessage("error",e);I.resetPin()}}function S(a){x(a,t);z.log("[DV PIN] performPinRequiredCheck",a);R({url:E.urls.pinCheckUrl,data:{ASINS:a,csrfToken:E.csrfToken,action:E.action},asin:a,complete:function(){z.log("[DV PIN] performPinRequiredCheck complete",K);if(K.callbackHandleAuth)K.callbackHandleAuth=!1,L(a);i(v)},success:function(b){z.log("[DV PIN] performPinRequiredCheck success",
b);var c=n;if((K.data=b)&&typeof b==="object")if(b.error==="BAD_REQUEST")c=k;else if(b.error==="TOKEN_INVALID")c=q;else if(b.pinRequired){if(c=n,b=b.numPinsRequired,z.debug(b),b)E.numPins=b,I.setNumViewPins(b)}else c=m;x(a,c)}})}var Q={},I,E={},N={},K={};z.log("[DV-PURCH] pin-controller");(function(a,b){z.debug(a,b);w.extend(!0,E,D,a);I=E.isTestRun&&b?b:e.create(E.view);g.bestowEvents(Q);I.on(E.view.events.submit,r);I.on(E.view.events.close,C);d.on("dv:purchase:cancel",function(a){delete N[a.asins];
delete K.activeAsin})})(c,h);return{on:function(a,b){Q.on([a],b)},trigger:i,isAuthorized:G,performPinRequiredCheck:S,getAsinStatus:y,handleAsinAuthorization:L}}}});i.when("A","jQuery","logging","aiv-util-event","aiv-modal","aiv-alerts").register("dv-pp-pin-view",function(d,h,e,g,c,f){var b=e.create("dv-pp-pin-view"),a={focusFieldsOnKeyUp:!0,id:"dv-purchase-pin-view",isIosDevice:!1,selectors:{modalSelector:"#dv-pin-pop",pinWrap:"#pin-wrap",continueButton:"#dv-purchase-pin-view-submit",cancelButton:"#dv-purchase-pin-view-cancel",
statusMsg:".dv-pin-pop-status-msg"},selectorFragments:{submitSuffix:"-submit"},hasCustomConfig:!1,pinConfig:{numPins:5,numPinInputs:s,pinInputParams:{pattern:"[0-9]*",type:"password",size:"1",maxlength:"1","class":"pinNum"}},events:{submit:"submitPin",show:"show",hide:"hide",close:"close"}};return{create:function(e){var i,j,k,q,t;function p(a,c){b.log("[PIN-VIEW] trigger",a);C.fire(a,c)}function o(){var a=document.createElement("input"),c=r.pinConfig.pinInputParams,d;b.log("[PIN-VIEW] createInputElem",
c);for(d in c)c.hasOwnProperty(d)&&a.setAttribute(d,c[d]);return a}function s(a){b.log("[PIN-VIEW] buildUpPopover",a);J=a.popover;i=J.$popover;a=i.find("input.pinNum");if(!a||!a.length){var c=i.find(r.selectors.pinWrap),d=r.pinConfig.numPinInputs||r.pinConfig.numPins;b.log("[PIN-VIEW] appendInputs",r);for(a=1;a<=d;a+=1)c.append(o());j=c.find("input");b.log("[PIN-VIEW] registerEventHandlers");k=h("#"+x.name+r.selectorFragments.submitSuffix);k.find("input").click(w);r.focusFieldsOnKeyUp&&(j.keyup(z),
j.keydown(v))}F()}function u(){b.log("[PIN-VIEW] tearDownPopover",i);p(r.events.close);H();j&&j.remove();i&&i.find("input").unbind();q=!1;delete i}function v(a){var c=h(this),a=a.which===8;b.log("[PIN-VIEW] handleKeyDown");a&&(c.val().length>0||c.prev("input").focus().val(""))}function z(a){var c=h(this),d=c.not().is(":last-child"),e=c.val().length>0,a=a.which===13,f=M().length===r.pinConfig.numPins;b.log("[PIN-VIEW] handleKeyUp");f?q&&(k.removeClass("a-button-disabled").find("input").removeAttr("disabled"),
q=!1):B();a&&f?w():e&&!d&&!f&&c.next().focus();t&&H()}function B(){q||(k.addClass("a-button-disabled").find("input").attr("disabled","disabled"),q=!0)}function w(){b.log("[PIN-VIEW] handleSubmit");p(r.events.submit)}function D(a){b.log("[PIN-VIEW] hide",x,a);a&&a.delay?d.delay(function(){x.remove()},a.delay):x.remove()}function M(){var a=[];j.each(function(b,c){c.value.length&&(c.value.length>1?a=c.value.split(""):a.push(c.value))});return a}function F(){b.log("[PIN-VIEW] resetPin");j.val("");d.delay(function(){j.first().focus()},
10);B()}function H(){t=!1;i&&i.find(r.selectors.statusMsg).html("")}var r={};q=void 0;t=void 0;var C={};i=void 0;j=void 0;k=void 0;var x,J;b.log("[PIN-VIEW]");h.extend(!0,r,a,e);b.log("[PIN-VIEW] init",r);g.bestowEvents(C);b.log("[PIN-VIEW] registerCustomEvents");C.on(r.events.show,function(){b.log("[PIN-VIEW] show",x);x=c.create({selector:r.selectors.modalSelector,id:r.id});b.log("[PIN-VIEW] registerAUIModalHandlers");x.on("afterShow",s);x.on("afterHide",u);x.on("dv:dv-modal:cancel",D);x.show()});
C.on(r.events.hide,D);return{getUserPin:function(){return M().join("")},on:function(a,c){b.log("[PIN-VIEW] on",a);C.on([a],c)},trigger:p,createMessage:function(a,b){var c;f[a]&&typeof(f[a]==="function")&&(c=f[a](b),H(),i.find(r.selectors.statusMsg).html(c),t=!0)},resetPin:F,setNumViewPins:function(a){if(a)r.pinConfig.numPins=a,r.hasCustomConfig?(r.pinConfig.pinInputParams.size=a,r.pinConfig.pinInputParams.maxlength=a):r.pinConfig.numPinInputs=a}}}}});i.when("A","jQuery","logging","promise-pipeline",
"purchase-modal").register("dv-hd-warning",function(d,h,e,g,c){function f(a,b,d){return function(){c.create({id:a,asin:d,deferred:b,continuePurchaseOnSubmit:!0,cancelPurchaseOnCancel:!0,urlParameters:{asin:d}}).show()}}var b=e.create("dv-hd-warning",i),a;i.when("dv-player-capabilities").execute(function(c){b.log("[DV-PURCH] hd-warning playerCapabilities",c);c.get(function(b){a=b})});return g.step("dv-hd-warning",function(c,d){var e,g,h;b.debug("[DV-PURCH] hd-warning",d,a);if(a)g=a.supportsWebPlayback,
h=a.supportsHDMovies;b.debug("supportsWebPlayback:",g,"supportsHDMovies:",h);e={showHDWarning:f("dv-modal-hd-content-warning",c,d.asin),showHDCPWarning:f("dv-modal-hdcp-content-warning",c,d.asin),showUnsupportedWarning:f("dv-modal-unsupported-device-warning",c,d.asin),continuePurchase:c.resolve};g?h?d.canShowWebHdcpWarning?e.showHDCPWarning():e.continuePurchase():d.canShowWebHdWarning?e.showHDWarning():e.continuePurchase():d.showUnsupportedWarning?e.showUnsupportedWarning():d.showDeviceHdWarning?
e.showHDWarning():d.showDeviceHdcpWarning?e.showHDCPWarning():e.continuePurchase()},i)});i.when("jQuery","logging","promise-pipeline").register("dv-sign-in",function(d,h,e){h.create("dv-sign-in",i);return e.step("dv-sign-in",function(d,c){c.shouldSignIn?j.location.replace(c.signInUrl):d.resolve()},i)});i.when("A","jQuery","logging","promise-pipeline","purchase-modal","dv-age-verification-data-ready").register("dv-age-verification",function(d,h,e,g,c){var f=e.create("dv-age-verification",i);return g.step("dv-age-verification",
function(b,a){var e=d.state("dv-age-verification-data");f.log("[DV-PURCH] dv-age-verification",a,e);e&&e.isAgeVerificationRequired?c.create({id:"dv-age-verification-modal",asin:a.asin,deferred:b}).show():b.resolve()},i)});i.when("A","jQuery","logging","promise-pipeline","dv-pp-pin-controller","purchase-modal","dv-purchasing-errors").register("dv-pin-verification",function(d,h,e,g,c,f,b){var a=e.create("dv-pin-verification",i);return g.step("dv-pin-verification",function(d,e){var f=e.pinVerification,
g=c.create(f);a.log("[DV-PURCH] pin-verification",f,e);g.on("success",function(b){a.log("Pin Check Success happened with args:",b);d.resolve(b)});g.on("pinAuthFailure",function(b){a.log("Pin Check Failure happened with args:",b);d.reject({reload:!1})});g.on("sessionExpired",function(c){a.log("Pin Check Failure happened with args:",c);d.reject({errors:[b.invalidCSRFToken()],reload:!1})});g.handleAsinAuthorization(e.asin)},i)});i.when("A","jQuery","logging","promise-pipeline","purchase-call-handler").register("dv-create-order",
function(d,h,e,g,c){e.create("dv-create-order",i);return g.step("dv-create-order",function(d,b){var a={deferred:d,endpoint:b.createOrder&&b.createOrder.url,callData:b.purchaseArgs||{},asins:b.asin,ajaxDataType:b.ajaxDataType,purchasingModalText:b.purchasingModalText},e=b.token;if(e)a.callData.pinToken=e;c.create(a).callPurchase()},i)});i.when("A","jQuery","logging","promise-pipeline","purchase-call-handler").register("dv-check-order-status",function(d,h,e,g,c){e.create("dv-check-order-status",i);
return g.step("dv-check-order-status",function(d,b){var a={deferred:d,endpoint:b.checkOrderStatus&&b.checkOrderStatus.url,callData:b.purchaseArgs,asins:b.asin,ajaxDataType:b.ajaxDataType,purchasingModalText:b.purchasingModalText};if(b.token)a.callData.pinToken=b.token;if(b.orderToken)a.callData.orderToken=b.orderToken;c.create(a).callPurchase()},i)});i.when("A","jQuery","logging","dv-async","dv-purchase-fix-up","aiv-client-side-metrics").register("purchase-call-handler",function(d,h,e,g,c,f){var b,
a,j,n,m,k,q=e.create("purchase-call-handler",i),t=g.create("purchase-call-handler",i);n="SUCCESS";k="ERROR";m="PENDING";var p={endpoint:"/gp/video/order/create-order.html",ajaxDataType:"jsonp",ajaxRetries:3,callData:s,jsonpCallback:s,isOrderStatusCheck:!1};a=f.create({scope:"dvweb-buybox-purchase"});b=f.create({scope:"dvweb-buybox-orderAction"});j=f.create({scope:"dvweb-buybox-polling"});return{create:function(d){function e(d){var h=d.action||{},o=d.orderToken;h.deferred=i.deferred;if(o)i.callData.orderToken=
o;q.log("[ajaxPurchase] _ajaxSuccess",navigator.userAgent,d);switch(d.status){case n:i.isOrderStatusCheck?(b.ajaxSuccess({requestId:d.requestId}),b.ajaxDone()):(a.ajaxSuccess({requestId:d.requestId}),a.ajaxDone());i.deferred.resolve({orderToken:d.orderToken});break;case m:j.counter("dvweb-checkOrderStatus-polling");t.delay(g,h.delay);break;case k:c.fix(f(h));break;default:c.fix(h)}}function f(a){if(i.purchasingModalText&&a.modal&&a.modal.header&&a.modal.header.text)a.modal.header.text=a.modal.header.text+
" "+i.purchasingModalText;return a}function g(){var b={params:i.callData,success:e,jsonpCallback:i.jsonpCallback},c={maxRetrys:i.ajaxRetries,customError:function(a,b,c){q.error(b,c);i.deferred&&i.deferred.reject()}};a.ajaxStart();t.ajax(i.endpoint,b,c)}var i={};h.extend(!0,i,p,d);q.log("[ajaxPurchase] create",i);return{callPurchase:function(){g()}}}}});i.when("A","jQuery","logging","purchase-modal").register("dv-purchase-fix-up",function(d,h,e,g){var c=e.create("dv-purchase-fix-up");return{fix:function(d){c.log("[fixUp] errorAction:",
d);d||(c.error("no action was passed to errorAction"),d={});d.deferred&&d.deferred.reject();if(d.modal){if(c.log("[fixUp] _actionModal:",d),d.modal)d.modal.deferred=d.deferred,g.create(d.modal).show()}else d.redirectUrl?(c.log("[fixUp] _actionRedirect args:",d),j.location.href=d.redirectUrl):(c.log("[fixUp] _generalError args:",d),g.create({id:"dv-modal-generic-error",cancelPurchaseOnSubmit:!0,deferred:d.deferred}).show())}}});i.when("A","jQuery","logging","aiv-modal").register("purchase-modal",function(d,
h,e,g){function c(b,a){var c=b.getName(),e=a.deferred;d.on("a:popover:beforeHide:"+c,function(a){f.log("a:popover:beforeHide:"+c+" happened",a,e);e&&e.reject({reload:!1})});b.on("submit",function(a){f.log("[DV-PURCH] purchase-modal submit",a,e);e&&e.resolve();b.remove()});b.on("link",function(a){f.log("[DV-PURCH] purchase-modal link",a,e);var c=a.url;c?j.location.href=c:f.error("purchaseModal link event called without url",a);b.remove()});b.on("cancel",function(a){f.log("[DV-PURCH] purchase-modal cancel",
a,e);e&&e.reject({reload:!1});b.remove()})}var f=e.create("purchase-modal");return{create:function(b){var a={cancel:{customEvent:"cancel",eventArgs:{asin:b.asin,id:b.id,cancelPurchaseOnCancel:typeof b.cancelPurchaseOnCancel!=="undefined"?b.cancelPurchaseOnCancel:!0}},submit:{customEvent:"submit",eventArgs:{asin:b.asin,id:b.id,continuePurchaseOnSubmit:b.continuePurchaseOnSubmit,retryPurchaseOnSubmit:b.retryPurchaseOnSubmit,cancelPurchaseOnSubmit:b.cancelPurchaseOnSubmit}},checked:{customEvent:"checked",
eventArgs:{id:b.id,elemId:b.id+"-check"}}},d=h("#"+b.id).data("dv-modal"),d=d&&d.buttons||[],e={},i,j;for(i=0;i<d.length;i++)j=d[i].type,e[j]=d[i];a=h.extend(!0,{},a,e);a=h.extend(!0,{},{showCloseButton:!1,footer:{},buttons:[a.cancel,a.submit,a.checked]},b);f.log("purchase-modal createModal with options",a);a=g.create(a);c(a,b);return a}}});i.when("dv-sign-in","dv-age-verification","dv-hd-warning","dv-pin-verification","dv-create-order","dv-check-order-status").register("purchase-pipeline",function(d,
h,e,g,c,f){return[d,h,e,g,c,f]});i.when("jQuery","logging","aiv-modal").register("dv-purchasing-errors",function(d,h,e){function g(a){this.name="MissingAsin";this.message=a;this.stack=Error().stack}function c(a){this.name="MissingPinToken";this.message=a;this.stack=Error().stack}function f(a){this.name="MissingCSRFToken";this.message=a;this.stack=Error().stack}function b(a){this.name="InvalidCSRFToken";this.message=a;this.stack=Error().stack}function a(a){this.name="MissingOrderToken";this.message=
a;this.stack=Error().stack}function j(a){var b=e.create({id:"dv-modal-session-expired"}).show();m.error(a.message,a.stack);b.on("dv:dv-modal:submit",function(){document.location.reload(!0)})}function n(a){var b=e.create({id:"dv-modal-generic-error"}).show();m.error(a.message,a.stack);b.on("dv:dv-modal:submit",function(){document.location.reload(!0)})}var m=h.create("dv-purchase-errors",i);return{handleError:function(a){a&&(m.log("_handleError",a),a instanceof b?j(a):n(a))},invalidCSRFToken:function(a){return new b(a)},
missingAsin:function(a){return new g(a)},missingPinToken:function(a){return new c(a)},missingCSRFToken:function(a){return new f(a)},missingOrderToken:function(b){return new a(b)}}});i.when("A","logging","promise-pipeline","aiv-modal","dv-purchasing-errors","purchase-pipeline").register("purchase-video",function(d,h,e,g,c,f){var b=h.create("purchase-video",i);return{start:function(a){b.log("[DV-PURCH] start",a);a=e.create({promises:f,options:a},"purchase-video",i);a.done(function(a){b.log("[DV-PURCH] pipeline has finished",
a)});a.fail(function(a){b.log("[DV-PURCH] pipeline has failed",a);a&&a.errors&&d.each(a.errors,function(a){c.handleError(a,i)})});return a}}});i.when("A","jQuery","logging","dv-purchase-data-ready").register("dv-purchase-continue",function(d,h,e){var g=e.create("dv-purchase-continue");return{checkPurchaseTriggers:function(){g.log("[purchase] checkPurchaseTriggers");var c=h.Deferred(),e=d.state("dv-purchase-continue-data")||{},b=e.purchaseAsin,a=e.purchaseToken,i=e.orderToken;g.log("[purchase] checkPurchaseTriggers state",
b,a,i);b&&(a||i)&&h.ajax({url:e.validateTokenUrl,data:{purchasetoken:a},success:function(a){g.log("[purchase] validateActionToken success",a);a.success&&c.resolve(b)},error:function(a){g.log("[purchase] validateActionToken error",a);c.reject(a)},dataType:"json"});return c.promise()}}});i.when("A","jQuery","logging","dv-form","dv-ux","dv-ux-mixins","dv-buttons","dv-utilities","dv-purchase-continue","purchase-video","dv-purchase-data-ready").register("dv-purchase-view",function(d,h,e,g,c,f,b,a,j,n){var m,
k,q;function t(a,b){d.trigger("aiv:modal:close:declarative");C.log("[DV-PURCH-VIEW] disableActionBoxes",b);var e=b.isSeasonPurchase?h(m):a.parents(m);b.isSeasonPurchase?(B(e.siblings(".dv-el-status-wrapper")),c.hideContent(e.siblings(".dv-el-more-offers"))):z(b.asin,c.hideContent);M(e,b);e=b.asin;C.log("[DV-PURCH-VIEW] addEpisodeListStatusSpinners",e);e=v(e);B(e);s(b)}function p(a){var b=a.parents("form"),b=g.data(b),c=d.state("dv-purchase-data")||{},a=a.find("input").data();return h.extend(!0,{},
c,a,{asin:b.asin,pinVerification:{csrfToken:b.csrfToken},purchaseArgs:b})}function o(a){var b=d.state("dv-purchase-view-data")||{};return!a?b:b[a]}function s(a){var b=n.start(a);C.log("[DV-PURCH-VIEW]",a);b.done(function(a){C.log("[DV-PURCH-VIEW] p.done",a);F(a)});b.fail(function(a){C.log("[DV-PURCH-VIEW] p.fail",a);F(a)})}function u(a,b){return h(a).filter(function(a,c){return!!h(c).find("[data-asin="+b+"]")[0]})}function v(b){var c,b=a.getElemByAlias(k,b);b.length&&(c=b.find(".dv-el-status-wrapper"));
return c}function z(b,c){var d;d=a.getElemByAlias(k,b);d.length&&c(d.find(".dv-el-more-offers"))}function B(a){a&&a.length&&a.each(function(a,b){c.hideContent(h(b));c.addSpinner(h(b))})}function w(a){a&&a.length&&a.each(function(){c.showContent(a);c.removeSpinner(a)})}function D(a){C.log("[DV-PURCH-VIEW] removeEpisodeListStatusSpinners",a);if(a=v(a))c.showContent(a),c.removeSpinner(a)}function M(a,b){C.log("[DV-PURCH-VIEW] disableSelectedActionBoxes",a,b);a.length&&a.each(function(a,c){var d=h(c),
e=d.hasClass(y),d=f.extendable(d),g=h("<p />").html(b.purchasingText),i=e?{}:{theme:"dark"},e=!(b.isSeasonPurchase&&e);d.addBehaviours(f.interactive,f.spinner);var j=b.asin;typeof d!=="undefined"&&(G[j]=G[j]||[],G[j].push(d));d.disable({disableOpacity:0}).addSpinner(i);e&&d.getSpinnerWrapper().value().append(g)})}function F(a){a.reload===!1?r(a.asin,a.isSeasonPurchase):H(a)}function H(b){var c=b.purchaseArgs.asin,e=o("pageAsin"),f=a.getElemByAlias(k,c),g=f.attr("id"),h=u(q,c),j=!!h.length,l=!!f.length,
m=b.isSeasonPurchase,n;C.log("resetActionBoxess",b,h,f);i.when("dv-ajax-reload").execute(function(a){var b=(d.state("dv-purchase-data")||{}).widgetRefresh.endpoint;j&&a.getWidgets({asin:e,url:b,loggingName:"dvweb-actionbox-purchase",widgets:["dv-action-box"]});m&&c?n=a.getWidgets({asin:e,url:b,loggingName:"dvweb-season-purchase",widgets:["dv-episode-list"]}):l&&c&&(n=a.getWidgets({asin:c,url:b,loggingName:"dvweb-episodelist-purchase",widgets:["dv-el-offers","dv-el-more-offers","dv-el-cancel-order",
"js-ajaxable-episode-status"],DOMRootID:g}));n&&n.done(function(){D(c)})})}function r(a,d){C.log("[DV-PURCH-VIEW] enableButtons");var e=d?h(m):u(m,a);e.length&&e.each(function(a,c){var d=h(c),e=d.find("."+J);f.extendable(d,f.interactive,f.spinner).removeSpinner().enable();b.resetButtonsOriginalState(e)});d?(w(e.siblings(".dv-el-status-wrapper")),c.showContent(e.siblings(".dv-el-more-offers"))):(z(a,c.showContent),D(a))}var C=e.create("dv-purchase-view");q="#dv-action-box";m=".js-dv-action-box, .js-dv-action-box-episode";
k=".dv-episode-container";var x=d.capabilities.touch,J="js-dv-processing",y="js-dv-action-box-episode",G={},e=j.checkPurchaseTriggers();C.info("[dv-purchase-view]");e.done(function(a){var a=u(".js-purchase-button",a),b=a.first(),b=p(b);t(a,b)});h("body").delegate(".js-purchase-button","click",function(a){var c=h(this),c=p(c),d=c.asin;C.log("[purchaseClick]",c);d=u(".js-purchase-button",d);d.hasClass(J)?(C.info("purchaseClick canceled",d),a.preventDefault(),a.stopImmediatePropagation()):(C.log("[DV-PURCH-VIEW]",
c),d.hasClass("dv-confirm")||!x?t(d,c):x&&(b.resetConfirmButtons(),b.addConfirmState(d,o("confirmButtonText")),a.stopPropagation()),a.preventDefault())})});i.when("A","logging").register("dv-order-cancellation",function(d,h){var e=h.create("dv-order-cancellation",i);d.on("cancel-order:dv-self-cancel-modal:submit",function(){e.log("cancel-order:dv-self-cancel-modal:submit");i.when("a-dropdown").execute(function(g){var c=g.getSelect("dv-self-refund-drop-down").val().split(":",2),g=c[0],c=c[1],f=d.$(".dvSelfCancelModal"),
b=f.data("orderCancelBaseUrl"),f=f.data("pageAsin");e.log("orderCancelation",g,c,b);if(g&&c&&b)document.location.href=b+"?orderId="+g+"&asin="+c+"&return_to=/gp/product/"+f})})})})})(function(){var i=window.AmazonUIPageJS||window.P,j=i._namespace||i.attributeErrors;return j?j("DigitalVideoWebPurchasingAssets"):i}(),window);